# postgresql-simple-init

PostgreSQLê³¼ Haskellì„ ì‚¬ìš©í•œ í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(Hexagonal Architecture) ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ˆì œì…ë‹ˆë‹¤.

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

- **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(í¬íŠ¸ & ì–´ëŒ‘í„°)** íŒ¨í„´ êµ¬í˜„
- **postgresql-simple**ì„ ì‚¬ìš©í•œ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
- **WAI/Warp**ë¥¼ ì‚¬ìš©í•œ ê²½ëŸ‰ HTTP ì„œë²„
- **Docker ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ**ë¥¼ í†µí•œ ìµœì í™”ëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€
- **Stack** ë¹Œë“œ ë„êµ¬ë¥¼ ì‚¬ìš©í•œ Haskell í”„ë¡œì íŠ¸ ê´€ë¦¬

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

í”„ë¡œì íŠ¸ëŠ” í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ë¥¼ ë”°ë¥´ë©° ë‹¤ìŒê³¼ ê°™ì€ ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Infrastructure Layer            â”‚
â”‚  (Postgres.hs - í™˜ê²½ë³€ìˆ˜, ì—°ê²° ê´€ë¦¬)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Adapters Layer                 â”‚
â”‚  (PostgresRepository.hs - êµ¬ì²´ êµ¬í˜„)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Application Layer                â”‚
â”‚  (UseCases.hs - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer                   â”‚
â”‚  (Model.hs, Repository.hs - ì¸í„°í˜ì´ìŠ¤) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```
.
â”œâ”€â”€ app/                    # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”‚   â””â”€â”€ Main.hs
â”œâ”€â”€ src/                    # ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ Domain/             # ë„ë©”ì¸ ê³„ì¸µ (ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚   â”‚   â”œâ”€â”€ Model.hs        # ì—”í„°í‹° ì •ì˜
â”‚   â”‚   â””â”€â”€ Repository.hs   # ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ (í¬íŠ¸)
â”‚   â”œâ”€â”€ Application/        # ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ
â”‚   â”‚   â””â”€â”€ UseCases.hs     # ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„
â”‚   â”œâ”€â”€ Adapters/           # ì–´ëŒ‘í„° ê³„ì¸µ
â”‚   â”‚   â””â”€â”€ PostgresRepository.hs  # PostgreSQL êµ¬í˜„ì²´
â”‚   â”œâ”€â”€ Infrastructure/     # ì¸í”„ë¼ ê³„ì¸µ
â”‚   â”‚   â””â”€â”€ Postgres.hs     # DB ì—°ê²° ê´€ë¦¬
â”‚   â””â”€â”€ Lib.hs              # ì• í”Œë¦¬ì¼€ì´ì…˜ ì¡°ë¦½ ë° HTTP ì„œë²„
â”œâ”€â”€ docker/                 # Docker ê´€ë ¨ íŒŒì¼
â”‚   â”œâ”€â”€ Dockerfile          # ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ
â”‚   â””â”€â”€ docker-compose.yaml # ì„œë¹„ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ test/                   # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”œâ”€â”€ static/                 # ì •ì  íŒŒì¼
â”œâ”€â”€ package.yaml            # í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ stack.yaml              # Stack ì„¤ì •
â””â”€â”€ Makefile                # ë¹Œë“œ ìë™í™”
```

## ğŸš€ ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- **Haskell Stack** (>= 2.0)
- **Docker & Docker Compose** (ì„ íƒì‚¬í•­, ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ)
- **PostgreSQL** (>= 12, ë¡œì»¬ ì‹¤í–‰ ì‹œ)

### ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •

#### 1. ì˜ì¡´ì„± ì„¤ì¹˜ ë° ë¹Œë“œ

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜ ë° í”„ë¡œì íŠ¸ ë¹Œë“œ
make setup
make build

# ë˜ëŠ” ì§ì ‘ Stack ëª…ë ¹ì–´ ì‚¬ìš©
stack setup
stack build
```

#### 2. PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì¤€ë¹„

ë¡œì»¬ì—ì„œ PostgreSQLì„ ì‹¤í–‰í•˜ê±°ë‚˜ Dockerë¡œ ì‹¤í–‰:

```bash
# Dockerë¡œ PostgreSQLë§Œ ì‹¤í–‰
docker run -d \
  --name postgres-dev \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=postgres \
  -p 5432:5432 \
  postgres:16-alpine
```

#### 3. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```bash
export DB_HOST=127.0.0.1
export DB_PORT=5432
export DB_NAME=postgres
export DB_USER=postgres
export DB_PASSWORD=postgres
```

#### 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```bash
# Makefile ì‚¬ìš©
make run

# ë˜ëŠ” Stack ì§ì ‘ ì‚¬ìš©
stack exec postgresql-simple-init-exe
```

ì„œë²„ê°€ `http://0.0.0.0:8000`ì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤.

### Docker Composeë¡œ ì‹¤í–‰

ì „ì²´ ìŠ¤íƒ(PostgreSQL + ì• í”Œë¦¬ì¼€ì´ì…˜)ì„ Docker Composeë¡œ ì‹¤í–‰:

```bash
# ì„œë¹„ìŠ¤ ì‹œì‘
make docker-compose-up

# ë¡œê·¸ í™•ì¸
make docker-compose-logs

# ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë³¼ë¥¨ ì‚­ì œ
make docker-compose-down
```

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë‹¤ìŒ HTTP ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

### `GET /`

- **ì„¤ëª…**: ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸
- **ì‘ë‹µ**: `OK`

### `GET /health`

- **ì„¤ëª…**: í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
- **ì‘ë‹µ**: `healthy`

### `GET /tests`

- **ì„¤ëª…**: ëª¨ë“  í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¡°íšŒ
- **ì‘ë‹µ ì˜ˆì‹œ**:

  ```
  1: Tomas
  ```

## ğŸ§ª í…ŒìŠ¤íŠ¸

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
make test

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸
make coverage

# íŒŒì¼ ë³€ê²½ ê°ì§€ ìë™ í…ŒìŠ¤íŠ¸
make watch-test
```

## ğŸ³ Docker

### Docker ì´ë¯¸ì§€ ë¹Œë“œ

```bash
# ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œë¡œ ì´ë¯¸ì§€ ìƒì„±
make docker-build

# ë˜ëŠ” ì§ì ‘ ë¹Œë“œ
docker build --build-arg PROJECT_NAME=postgresql-simple-init \
  -t postgresql-simple-init:latest \
  -f docker/Dockerfile .
```

### Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# ë‹¨ë… ì‹¤í–‰ (PostgreSQL ë³„ë„ í•„ìš”)
make docker-run

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
docker run -it --rm \
  --name postgresql-simple-init-app \
  -p 8000:8000 \
  -e DB_HOST=host.docker.internal \
  -e DB_PORT=5432 \
  -e DB_NAME=postgres \
  -e DB_USER=postgres \
  -e DB_PASSWORD=postgres \
  postgresql-simple-init:latest
```

## ğŸ”§ ê°œë°œ ë„êµ¬

### ì½”ë“œ í¬ë§·íŒ…

```bash
# stylish-haskellë¡œ ì½”ë“œ í¬ë§·íŒ…
make format

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
./format.sh
```

### GHCID (ë¹ ë¥¸ í”¼ë“œë°±)

```bash
# íŒŒì¼ ë³€ê²½ ì‹œ ìë™ ì¬ì»´íŒŒì¼
make ghcid
```

## ğŸ“¦ ë¹Œë“œ ì‚°ì¶œë¬¼

### ë¡œì»¬ ì„¤ì¹˜

```bash
# ì‹¤í–‰ íŒŒì¼ì„ ~/.local/binì— ì„¤ì¹˜
make install
```

### ë¦´ë¦¬ì¦ˆ ë¹Œë“œ

```bash
# ìµœì í™”ëœ ë¦´ë¦¬ì¦ˆ ë¹Œë“œ
make release
```

## ğŸ› ï¸ Makefile ì£¼ìš” íƒ€ê²Ÿ

| íƒ€ê²Ÿ | ì„¤ëª… |
|------|------|
| `make all` | ì „ì²´ ë¹Œë“œ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (clean â†’ setup â†’ build â†’ test â†’ run) |
| `make clean` | ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ ì •ë¦¬ |
| `make setup` | ì˜ì¡´ì„± ì„¤ì¹˜ |
| `make build` | í”„ë¡œì íŠ¸ ë¹Œë“œ |
| `make test` | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ |
| `make run` | ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ |
| `make format` | ì½”ë“œ í¬ë§·íŒ… |
| `make docker-build` | Docker ì´ë¯¸ì§€ ë¹Œë“œ |
| `make docker-compose-up` | Docker Composeë¡œ ì „ì²´ ìŠ¤íƒ ì‹œì‘ |
| `make docker-compose-down` | Docker Compose ìŠ¤íƒ ì¤‘ì§€ |

## ğŸ”‘ í™˜ê²½ë³€ìˆ˜

| ë³€ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `DB_HOST` | `127.0.0.1` | PostgreSQL í˜¸ìŠ¤íŠ¸ |
| `DB_PORT` | `5432` | PostgreSQL í¬íŠ¸ |
| `DB_NAME` | `postgres` | ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ |
| `DB_USER` | `postgres` | ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì |
| `DB_PASSWORD` | `postgres` | ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ |

## ğŸ“š ì£¼ìš” ì˜ì¡´ì„±

- **base**: Haskell ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **postgresql-simple**: PostgreSQL í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **wai**: Web Application Interface
- **warp**: ê³ ì„±ëŠ¥ HTTP ì„œë²„
- **flow**: í•¨ìˆ˜ í•©ì„± ìœ í‹¸ë¦¬í‹°
- **bytestring**: íš¨ìœ¨ì ì¸ ë°”ì´íŠ¸ ë¬¸ìì—´ ì²˜ë¦¬
- **http-types**: HTTP íƒ€ì… ì •ì˜

## ğŸ“– í•™ìŠµ í¬ì¸íŠ¸

ì´ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë‹¤ìŒì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜**: ë„ë©”ì¸ ë¡œì§ê³¼ ì¸í”„ë¼ë¥¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•
2. **íƒ€ì…í´ë˜ìŠ¤ ê¸°ë°˜ ì¶”ìƒí™”**: `TestRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ì˜ì¡´ì„± ì—­ì „
3. **ëª¨ë‚˜ë”• íŒ¨í„´**: `PostgresRepo` ëª¨ë‚˜ë“œë¥¼ í†µí•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ì‚° ì¶”ìƒí™”
4. **Docker ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ**: ê²½ëŸ‰í™”ëœ í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ìƒì„±
5. **í™˜ê²½ ê¸°ë°˜ ì„¤ì •**: 12-Factor App ì›ì¹™ ì ìš©

## ğŸ“ ë¼ì´ì„ ìŠ¤

BSD-3-Clause

## ğŸ‘¤ ì‘ì„±ì

**Mingyu Choo**

- Email: <mingyuchoo@gmail.com>
- GitHub: [@mingyuchoo](https://github.com/mingyuchoo)

## ğŸ¤ ê¸°ì—¬

ì´ìŠˆ ì œë³´ì™€ í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤!

---

**ì°¸ê³ **: ì´ í”„ë¡œì íŠ¸ëŠ” í•™ìŠµ ëª©ì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
